(function(g){g.extend({localDb:function(k,h){function j(a,d){console.log("Checking if loaded...");var b=!0,e;for(e in a)localStorage[a[e]]||(b=!1);b?setTimeout(d,10):setTimeout(function(){j(a,d)},1E3)}localStorage||(localStorage={});return{load:function(a,d){var b=[];if(localStorage.versions){var e=JSON.parse(localStorage.versions),f;for(f in a){var c=a[f];(!localStorage[c]||e[c]!=h)&&b.push(c)}}else localStorage.versions="{}",b=a;if(0<b.length)for(f in b)c=b[f],g.ajax({url:k+c,success:function(a){a:{var b=
c;try{JSON.parse(a)}catch(d){console.log("Server response was not JSON");break a}localStorage[b]=a;a=JSON.parse(localStorage.versions);a[b]=h;localStorage.versions=JSON.stringify(a)}console.log("Fetched update from server")},error:function(){console.log("Error fetching data from server")}});j(a,d)},table:function(a){return localStorage[a]}}}})})(jQuery);